<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

      <!-- Title handling -->
    <title>Managing settings in Python projects | Gribouillis</title>
    <!-- Meta description -->
    <meta name="description" content="Mindless sketches ✐ᝰ">
    <link rel="stylesheet" href="https://blog.natfu.be/css/main.css">
      <!-- RSS Feed -->
      
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.natfu.be/rss.xml">
      
  </head>
  <body>
    <header>
      <div class="nav-container">
        <div class="nav-heading">
          <div class="font-3rem">Gribouillis</div>
          <p>Mindless sketches ✐ᝰ</p>
        </div>
        <div class="nav-content">
          <nav>
            <a href="https://blog.natfu.be">Posts</a>
            <a href="https://blog.natfu.be/about">About</a>
          </nav>
        </div>
      </div>
    </header>
    <main role="main">
      
<h1 class="title">
  Managing settings in Python projects
</h1>
    <div class="post-meta">
      <time class="published" datetime="2025-07-05">
        Published: July 05, 2025
      </time>

      
    </div>
<hr class="separator">
<h2 id="motivation">Motivation</h2>
<p>In general, I've not seen any strong prescription in how to deal with settings when
working on Python applications. As the project grows and when you're exposing multiple
kinds of configurations, it makes sense to have a common interface to handle settings.</p>
<p>Otherwise, it can lead to some frustration, as any time you're working on an application
with multiple people, you'll find a mix of <code>.env</code> or JSON files, hard-coded global
variables and even some amount of setting and getting global environment variables.</p>
<p>What I've found useful instead of using any mix of the above solutions, is to define
<strong>local</strong>, <strong>immutable</strong> and <strong>dumb</strong> python objects defined in one place, which I can
then pass around the application. Ideally, I do not want to add a new dependency solely
for configuration purposes so the solution I'm looking for should rely on the standard
library. Note that if you already depend on
<a rel="noopener external" target="_blank" href="https://docs.pydantic.dev/latest/">pydantic</a>, they have a library called
<a rel="noopener external" target="_blank" href="https://docs.pydantic.dev/latest/concepts/pydantic_settings/"><code>pydantic-settings</code></a>
which fits the bill but I wouldn't introduce it otherwise.</p>
<p>Depending on your background and experience, you might never have encountered
those issues but if you work in data science or on machine learning adjacent
projects, they'll probably ring a bell, in part because of choices made in the
most common frameworks and libraries in the field.</p>
<p>N.B: You can <a href="https://blog.natfu.be/managing-settings-in-python-projects/#code">jump to the code</a> if you prefer.</p>
<h2 id="what-makes-useful-settings">What makes useful settings</h2>
<p>Developing the previous section a bit more in depth, I believe great settings are:</p>
<ul>
<li><strong>local</strong> in the sense that they shouldn't modify or be affected by some global state
and should be safe to pass around in different parts of the code.</li>
<li><strong>immutable</strong> such that there is no question about the configuration, it is setup
once and there is no potential change of state as you would have with a <code>dict</code>.</li>
<li><strong>dumb</strong>, meaning that there is no specific behavior of business logic implemented
by the settings object, it should be plain data.</li>
</ul>
<p>You might have an inkling to where I'm going with this: using
<a rel="noopener external" target="_blank" href="https://docs.python.org/3/library/dataclasses.html"><code>dataclasses</code></a>, which were added
back in Python 3.7 and truly blossomed in Python 3.10 when many new features appeared.</p>
<p>I'll also add that you should put your configuration related <code>dataclasses</code> in one module,
which I usually call <code>settings.py</code> or <code>config.py</code>. Moreover, you should have one object
per kind of setting (web server, DB, resource access,…) though having a larger object
that bundles all configurations is fine.</p>
<p>Let's go with an example now, where I'll setup the <a rel="noopener external" target="_blank" href="https://docs.sqlalchemy.org/en/20/core/engines.html#engine-configuration">connection to a DB with
SQLAlchemy</a>,
with a bit more legwork in order to build a <code>Secret</code> type, which isn't safe by
any means but won't default to printing the value of the secret.</p>
<p>In a <code>config.py</code>, there's now:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#24292E, #E1E4E8); background-color: light-dark(#FFFFFF, #24292E);"><code data-lang="python"><span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">from</span><span> dataclasses</span><span style="color: light-dark(#D73A49, #F97583);"> import</span><span> dataclass</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">from</span><span> typing</span><span style="color: light-dark(#D73A49, #F97583);"> import</span><span> final</span><span>,</span><span> override</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#6F42C1, #B392F0);">@</span><span style="color: light-dark(#6F42C1, #B392F0);">final</span></span>
<span class="giallo-l"><span style="color: light-dark(#6F42C1, #B392F0);">@</span><span style="color: light-dark(#6F42C1, #B392F0);">dataclass</span><span>(</span><span style="color: light-dark(#E36209, #FFAB70);">frozen</span><span style="color: light-dark(#D73A49, #F97583);">=</span><span style="color: light-dark(#005CC5, #79B8FF);">True</span><span>,</span><span style="color: light-dark(#E36209, #FFAB70);"> repr</span><span style="color: light-dark(#D73A49, #F97583);">=</span><span style="color: light-dark(#005CC5, #79B8FF);">False</span><span>)</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">class</span><span style="color: light-dark(#6F42C1, #B392F0);"> Secret</span><span>:</span></span>
<span class="giallo-l"><span>    _value</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#6F42C1, #B392F0);">    @</span><span style="color: light-dark(#005CC5, #79B8FF);">property</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">    def</span><span style="color: light-dark(#6F42C1, #B392F0);"> value</span><span>(</span><span>self</span><span>)</span><span> -&gt;</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span><span>:</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">        raise</span><span style="color: light-dark(#005CC5, #79B8FF);"> NotImplementedError</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">    def</span><span style="color: light-dark(#6F42C1, #B392F0);"> get_secret_value</span><span>(</span><span>self</span><span>)</span><span> -&gt;</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span><span>:</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">        return</span><span style="color: light-dark(#005CC5, #79B8FF);"> self</span><span>.</span><span>_value</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#6F42C1, #B392F0);">    @</span><span style="color: light-dark(#6F42C1, #B392F0);">override</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">    def</span><span style="color: light-dark(#005CC5, #79B8FF);"> __str__</span><span>(</span><span>self</span><span>)</span><span> -&gt;</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span><span>:</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">        return</span><span style="color: light-dark(#032F62, #9ECBFF);"> &quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">Secret(*****)</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#6F42C1, #B392F0);">    @</span><span style="color: light-dark(#6F42C1, #B392F0);">override</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">    def</span><span style="color: light-dark(#005CC5, #79B8FF);"> __repr__</span><span>(</span><span>self</span><span>)</span><span> -&gt;</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span><span>:</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">        return</span><span style="color: light-dark(#032F62, #9ECBFF);"> &quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">Secret(*****)</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#6F42C1, #B392F0);">@</span><span style="color: light-dark(#6F42C1, #B392F0);">dataclass</span><span>(</span><span style="color: light-dark(#E36209, #FFAB70);">frozen</span><span style="color: light-dark(#D73A49, #F97583);">=</span><span style="color: light-dark(#005CC5, #79B8FF);">True</span><span>,</span><span style="color: light-dark(#E36209, #FFAB70);"> kw_only</span><span style="color: light-dark(#D73A49, #F97583);">=</span><span style="color: light-dark(#005CC5, #79B8FF);">True</span><span>)</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">class</span><span style="color: light-dark(#6F42C1, #B392F0);"> DBSettings</span><span>:</span></span>
<span class="giallo-l"><span>    drivername</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span></span>
<span class="giallo-l"><span>    username</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span></span>
<span class="giallo-l"><span>    password</span><span>:</span><span> Secret</span></span>
<span class="giallo-l"><span>    host</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span></span>
<span class="giallo-l"><span>    port</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> int</span></span>
<span class="giallo-l"><span>    database</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">    def</span><span style="color: light-dark(#6F42C1, #B392F0);"> to_dict</span><span>(</span><span>self</span><span>)</span><span> -&gt;</span><span> dict</span><span>[</span><span style="color: light-dark(#005CC5, #79B8FF);">str</span><span>,</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span><span style="color: light-dark(#D73A49, #F97583);"> |</span><span style="color: light-dark(#005CC5, #79B8FF);"> int</span><span>]</span><span>:</span></span>
<span class="giallo-l"><span style="color: light-dark(#6A737D, #6A737D);">        #</span><span style="color: light-dark(#6A737D, #6A737D);"> dataclasses.asdict is also valid</span></span>
<span class="giallo-l"><span style="color: light-dark(#6A737D, #6A737D);">        #</span><span style="color: light-dark(#6A737D, #6A737D);"> as long as the password is handled properly</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">        return</span><span> {</span></span>
<span class="giallo-l"><span style="color: light-dark(#032F62, #9ECBFF);">            &quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">drivername</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> self</span><span>.</span><span>drivername</span><span>,</span></span>
<span class="giallo-l"><span style="color: light-dark(#032F62, #9ECBFF);">            &quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">username</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> self</span><span>.</span><span>username</span><span>,</span></span>
<span class="giallo-l"><span style="color: light-dark(#032F62, #9ECBFF);">            &quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">password</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> self</span><span>.</span><span>password</span><span>.</span><span>get_secret_value</span><span>(</span><span>)</span><span>,</span></span>
<span class="giallo-l"><span style="color: light-dark(#032F62, #9ECBFF);">            &quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">host</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> self</span><span>.</span><span>host</span><span>,</span></span>
<span class="giallo-l"><span style="color: light-dark(#032F62, #9ECBFF);">            &quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">port</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> self</span><span>.</span><span>port</span><span>,</span></span>
<span class="giallo-l"><span style="color: light-dark(#032F62, #9ECBFF);">            &quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">database</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> self</span><span>.</span><span>database</span><span>,</span></span>
<span class="giallo-l"><span>        }</span></span></code></pre>
<p>Which makes it possible to pass the dictionary generated from <code>DBSettings</code>, to
the <code>URL.create</code> function of SQLAlchemy.</p>
<p>By using <code>frozen=True</code>, any attempt at modifying the members of <code>DBSettings</code>
will raise a <code>FrozenInstanceError</code>.</p>
<p>You can improve the snippet by setting default values with the <code>field</code> function
of <code>dataclasses</code>.</p>
<h3 id="settings-from-files">Settings from files</h3>
<p>Of course, you might want or need to read the configuration from a file, let's
say a <code>.env</code> one. Such a file will look like this:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#24292E, #E1E4E8); background-color: light-dark(#FFFFFF, #24292E);"><code data-lang="plain"><span class="giallo-l"><span>DB_DRIVERNAME=postgresql+psycopg</span></span>
<span class="giallo-l"><span>DB_USERNAME=user</span></span>
<span class="giallo-l"><span>...</span></span></code></pre>
<p>I don't want to install <code>python-dotenv</code>, it's yet another dependency that I
think isn't needed. A simple alternative is to create a class method that
receives a file path, and build the settings from there. I'll also create a
couple helper functions to find the root of the project since environment and
configuration files are often at the root.</p>
<p>Still in the <code>config.py</code>, I'll add:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#24292E, #E1E4E8); background-color: light-dark(#FFFFFF, #24292E);"><code data-lang="python"><span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">from</span><span> pathlib</span><span style="color: light-dark(#D73A49, #F97583);"> import</span><span> Path</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#005CC5, #79B8FF);">PROJ_ROOT</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span> Path</span><span>(</span><span style="color: light-dark(#005CC5, #79B8FF);">__file__</span><span>)</span><span>.</span><span>parents</span><span>[</span><span style="color: light-dark(#005CC5, #79B8FF);">1</span><span>]</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">def</span><span style="color: light-dark(#6F42C1, #B392F0);"> get_project_root</span><span>(</span><span>)</span><span> -&gt;</span><span> Path</span><span>:</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">    return</span><span style="color: light-dark(#005CC5, #79B8FF);"> PROJ_ROOT</span></span></code></pre>
<p>Now, to get a configuration file from the root, you can do:</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#24292E, #E1E4E8); background-color: light-dark(#FFFFFF, #24292E);"><code data-lang="python"><span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">from</span><span> app</span><span style="color: light-dark(#D73A49, #F97583);"> import</span><span> config</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span>env_file</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span> config</span><span>.</span><span>get_project_root</span><span>(</span><span>)</span><span style="color: light-dark(#D73A49, #F97583);"> /</span><span style="color: light-dark(#032F62, #9ECBFF);"> &quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">.env</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span></span>
<span class="giallo-l"><span style="color: light-dark(#6A737D, #6A737D);">#</span><span style="color: light-dark(#6A737D, #6A737D);"> ...</span></span></code></pre>
<p>We'll want to be able to read files and generate a settings object straight from an
<code>.env</code> file, I've made some choices about how to read the file: only accepting prefixed
variables and ignoring extraneous variables.</p>
<p>Here's the abridged version of the <code>DBSettings</code> object with a new prefix as well
as a couple tools annotations since they are static analysis tools and I am
relying on dynamic typing by fetching the types of the fields straight from the
class definition.</p>
<pre class="giallo" style="color-scheme: light dark; color: light-dark(#24292E, #E1E4E8); background-color: light-dark(#FFFFFF, #24292E);"><code data-lang="python"><span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">from</span><span> dataclasses</span><span style="color: light-dark(#D73A49, #F97583);"> import</span><span> dataclass</span><span>,</span><span> fields</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">from</span><span> pathlib</span><span style="color: light-dark(#D73A49, #F97583);"> import</span><span> Path</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">from</span><span> typing</span><span style="color: light-dark(#D73A49, #F97583);"> import</span><span> ClassVar</span><span>,</span><span> Self</span><span>,</span><span> final</span><span>,</span><span> override</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#6F42C1, #B392F0);">@</span><span style="color: light-dark(#6F42C1, #B392F0);">dataclass</span><span>(</span><span style="color: light-dark(#E36209, #FFAB70);">frozen</span><span style="color: light-dark(#D73A49, #F97583);">=</span><span style="color: light-dark(#005CC5, #79B8FF);">True</span><span>,</span><span style="color: light-dark(#E36209, #FFAB70);"> kw_only</span><span style="color: light-dark(#D73A49, #F97583);">=</span><span style="color: light-dark(#005CC5, #79B8FF);">True</span><span>)</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">class</span><span style="color: light-dark(#6F42C1, #B392F0);"> DBSettings</span><span>:</span></span>
<span class="giallo-l"><span>    env_prefix</span><span>:</span><span> ClassVar</span><span>[</span><span style="color: light-dark(#005CC5, #79B8FF);">str</span><span>]</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span style="color: light-dark(#032F62, #9ECBFF);"> &quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">DB_</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span></span>
<span class="giallo-l"><span>    drivername</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span></span>
<span class="giallo-l"><span>    username</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span></span>
<span class="giallo-l"><span>    password</span><span>:</span><span> Secret</span></span>
<span class="giallo-l"><span>    host</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span></span>
<span class="giallo-l"><span>    port</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> int</span></span>
<span class="giallo-l"><span>    database</span><span>:</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span></span>
<span class="giallo-l"></span>
<span class="giallo-l"><span style="color: light-dark(#6F42C1, #B392F0);">    @</span><span style="color: light-dark(#005CC5, #79B8FF);">classmethod</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">    def</span><span style="color: light-dark(#6F42C1, #B392F0);"> from_dotenv</span><span>(</span><span>cls</span><span>:</span><span> type</span><span>[</span><span>Self</span><span>]</span><span>,</span><span> fp</span><span>:</span><span> Path</span><span>)</span><span> -&gt;</span><span> Self</span><span>:</span></span>
<span class="giallo-l"><span>        cls_fields</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span> fields</span><span>(</span><span style="color: light-dark(#005CC5, #79B8FF);">cls</span><span>)</span></span>
<span class="giallo-l"><span>        key_type_map</span><span>:</span><span> dict</span><span>[</span><span style="color: light-dark(#005CC5, #79B8FF);">str</span><span>,</span><span style="color: light-dark(#005CC5, #79B8FF);"> type</span><span>]</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span> {</span><span style="color: light-dark(#6A737D, #6A737D);">  #</span><span style="color: light-dark(#6A737D, #6A737D);"> pyright: ignore[reportAssignmentType]</span></span>
<span class="giallo-l"><span>            f</span><span>.</span><span>name</span><span>:</span><span> f</span><span>.</span><span>type</span><span style="color: light-dark(#D73A49, #F97583);"> for</span><span> f</span><span style="color: light-dark(#D73A49, #F97583);"> in</span><span> cls_fields</span><span style="color: light-dark(#D73A49, #F97583);"> if</span><span style="color: light-dark(#D73A49, #F97583);"> not</span><span> f</span><span>.</span><span>name</span><span>.</span><span>startswith</span><span>(</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">_</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span><span>)</span></span>
<span class="giallo-l"><span>        }</span></span>
<span class="giallo-l"><span>        data</span><span>:</span><span> dict</span><span>[</span><span style="color: light-dark(#005CC5, #79B8FF);">str</span><span>,</span><span style="color: light-dark(#005CC5, #79B8FF);"> str</span><span style="color: light-dark(#D73A49, #F97583);"> |</span><span> Secret</span><span style="color: light-dark(#D73A49, #F97583);"> |</span><span style="color: light-dark(#005CC5, #79B8FF);"> int</span><span>]</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span> {</span><span>}</span></span>
<span class="giallo-l"><span>        lines</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span> [</span></span>
<span class="giallo-l"><span>            line</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">            for</span><span> line</span><span style="color: light-dark(#D73A49, #F97583);"> in</span><span> fp</span><span>.</span><span>read_text</span><span>(</span><span>)</span><span>.</span><span>lstrip</span><span>(</span><span>)</span><span>.</span><span>splitlines</span><span>(</span><span>)</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">            if</span><span> line</span><span>.</span><span>startswith</span><span>(</span><span style="color: light-dark(#005CC5, #79B8FF);">cls</span><span>.</span><span>env_prefix</span><span>)</span></span>
<span class="giallo-l"><span>        ]</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">        for</span><span> line</span><span style="color: light-dark(#D73A49, #F97583);"> in</span><span> lines</span><span>:</span></span>
<span class="giallo-l"><span>            key</span><span>,</span><span> val</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span> (</span><span>s</span><span>.</span><span>strip</span><span>(</span><span>)</span><span style="color: light-dark(#D73A49, #F97583);"> for</span><span> s</span><span style="color: light-dark(#D73A49, #F97583);"> in</span><span> line</span><span>.</span><span>split</span><span>(</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span><span style="color: light-dark(#032F62, #9ECBFF);">=</span><span style="color: light-dark(#032F62, #9ECBFF);">&quot;</span><span>)</span><span>)</span></span>
<span class="giallo-l"><span>            key</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span> key</span><span>.</span><span>lower</span><span>(</span><span>)</span><span>.</span><span>removeprefix</span><span>(</span><span style="color: light-dark(#005CC5, #79B8FF);">cls</span><span>.</span><span>env_prefix</span><span>.</span><span>lower</span><span>(</span><span>)</span><span>)</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">            if</span><span> key</span><span style="color: light-dark(#D73A49, #F97583);"> in</span><span> key_type_map</span><span>:</span></span>
<span class="giallo-l"><span>                dtype</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span> key_type_map</span><span>[</span><span>key</span><span>]</span></span>
<span class="giallo-l"><span>                data</span><span>[</span><span>key</span><span>]</span><span style="color: light-dark(#D73A49, #F97583);"> =</span><span> dtype</span><span>(</span><span>val</span><span>)</span></span>
<span class="giallo-l"><span style="color: light-dark(#D73A49, #F97583);">        return</span><span style="color: light-dark(#005CC5, #79B8FF);"> cls</span><span>(</span><span style="color: light-dark(#D73A49, #F97583);">**</span><span>data</span><span>)</span><span style="color: light-dark(#6A737D, #6A737D);">  #</span><span style="color: light-dark(#6A737D, #6A737D);"> pyright: ignore[reportArgumentType]</span></span></code></pre>
<p>I think this is a decently useful implementation which can be extended or copied
for anyone's needs.</p>
<h2 id="on-testing-and-debugging">On testing and debugging</h2>
<p>Thanks to the approach outlined above, creating test specific settings becomes
only a matter of creating a settings object with a testing configuration. This
lowers the bar for testing and shortens the feedback loop when changing the
configuration and re-running the tests.</p>
<p>When you're debugging, it only becomes a matter of setting a breakpoint or
reading the logs, to access the state of your application defined by the
settings. You don't need to chase down some global variables, print the whole
environment or trace back what file accessed some <em>config</em> in what order.</p>
<p>This is true in many more cases than simply settings and configuration objects.
Any time you can reduce the surface of the code provoking state changes and
localize the effects of those changes, you should do so, it will pay back
dividends in clearer and tighter feedback loops.</p>
<h2 id="tools-nudging-you-in-the-right-and-wrong-direction">Tools nudging you in the right (and wrong) direction</h2>
<p>I'll stand on the shoulders of giants and show some libraries I think do a good
job showing users how to use settings properly and which are not.</p>
<p>In terms of settings, the web framework FastAPI has a <a rel="noopener external" target="_blank" href="https://fastapi.tiangolo.com/advanced/settings/">guide on how to define
settings</a> which uses
<code>pydantic-settings</code>, mentioned earlier.</p>
<p>SQLAlchemy <a rel="noopener external" target="_blank" href="https://docs.sqlalchemy.org/en/20/core/engines.html">also explains how to
configure</a> its engine and
connections properly through settings.</p>
<p>In both cases, they nudge you in the right direction since they receive some
form of settings objects which is passed around the application and you're free
to define them as you want, most of the time.</p>
<p>When you go into the data science realm though, you often encounter issues both
for historic and tooling reasons. <a rel="noopener external" target="_blank" href="https://jupyter.org/">Jupyter notebooks</a>
which are really popular for experimenting encourage having everything in one
notebook and run some cells or all cells when there are some changes to the
code. As a result, it's frequent for developers to put important variables in
the environment or in global variables, at the top of the notebook. When the
code is moved to production, those patterns stay as well and "infect" everything
with mutable global state.</p>
<p>In my experience, a common frustrating case is when you're dealing with
<a rel="noopener external" target="_blank" href="https://docs.conda.io/en/latest/">anaconda</a> and tools that require to be in the front
row seat like the job scheduler, <a rel="noopener external" target="_blank" href="https://airflow.apache.org/">Airflow</a>. If you, like me,
have an instance of Airflow running on a server with a lot of projects, it can be tough.
Looking at Airflow's documentation
<a rel="noopener external" target="_blank" href="https://airflow.apache.org/docs/apache-airflow/stable/howto/set-config.html">on its configuration</a>
as well as
<a rel="noopener external" target="_blank" href="https://airflow.apache.org/docs/apache-airflow/stable/administration-and-deployment/modules_management.html">its module documentation</a>,
there is a ton of explanation in how to export environment variables, modify the
<code>PYTHONPATH</code> environment variables, and so on. Being able to use configuration files like
<code>airflow.cfg</code> is great but the fact the documentation is falling back on global
environment variables isn't. Same for
<a rel="noopener external" target="_blank" href="https://airflow.apache.org/docs/apache-airflow/stable/howto/variable.html">Airflow variables</a>
where the first example includes using environment variables. If you mix bash and python,
typically when retrieving data and then processing it, you're in for a world of hurt. I
also mention <code>conda</code> because it's typical to activate an environment globally for a
project to have access to all its executables, in tandem with Airflow, the state of your
application quickly becomes tough to manage.</p>
<p>Now, you can take some steps to alleviate the issues I just mentioned:</p>
<ul>
<li>Use files over hard-coded environment variables when possible.</li>
<li>Create settings objects and use them in your DAG files (or similar for other
tools) as much as possible.</li>
<li>Avoid setting variables in the global environment (<code>os.environ</code>) and pass down
the required data to each class/function/DAG, when needed.</li>
<li>Use absolute paths to refer to executables and register them once in a
settings object.</li>
<li>Conversely, avoid global mutation like <code>source &lt;file&gt;</code>, <code>conda activate</code>, etc.</li>
</ul>
<h2 id="code">Code</h2>
<p>You can read the <a rel="noopener external" target="_blank" href="https://github.com/Nathan-Furnal/settings-management">full code and
tests</a> to get a better
picture of the final result.</p>
<h2 id="conclusion">Conclusion</h2>
<p>There's little consensus on how to manage settings properly in Python projects,
but in general you'll want your settings to be local, immutable and act as plain
data. Python's standard library offers a way to do it with frozen <code>dataclasses</code>
and we can easily add some functionalities to read from configuration files like
a <code>.env</code> file.</p>
<p>Some tools will nudge you in the right direction because they use and document
settings objects while some other tools make it harder and you need to be more
vigilant in how you define the configuration and make it accessible to different
parts of the code.</p>


      </main>
    <footer>
      Nathan Furnal © 2026
    </footer>
  </body>
</html>
